
```{python}
#| label: set-up
import os
import numpy as np
import pandas as pd
import sklearn as sk
import shap
import os
import sys
from datetime import datetime
from sklearn.ensemble import IsolationForest

sys.path.append(os.getcwd())
sys.path.append(os.path.dirname(os.getcwd()))

import scripts.cons as cons
```

# Data Load

```{python}
#| label: data-load
# load random telecom payments data
user_feat_foath = os.path.join('..', 'data', 'report', 'user_feat_data.csv')
feat_data = pd.read_csv(user_feat_foath)
feat_data.head()
```

# Isolation Forests Model

```{python}
#| label: score-data
# train isolation forests
id_cols = ['userid', 'transaction_week']
X_cols = ['E901_size', 'E901_sum']
train_data = feat_data[X_cols].copy()
clf = IsolationForest(random_state=0).fit(train_data)
# score data
score_data = feat_data[id_cols+X_cols].copy()
score_data['score'] = clf.decision_function(train_data)
score_data = score_data.sort_values(by='score')
```


```{python}
# count up the number of fraudulent transactions
feat_data['E901_size'].value_counts()/feat_data['E901_size'].value_counts().sum()
```